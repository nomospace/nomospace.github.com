<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="author" content="nomospace" />
<meta name="keywords" content="" />
<meta property="wb:webmaster" content="9d4b91032648dbe0" />
<title>挪墨的空间 / html5 文件拖放的一个简单实例</title>
<link href="http://nomospace.github.com/feed.xml" rel="alternate" title="挪墨的空间" type="application/atom+xml" />
<link rel="stylesheet" type="text/css" href="/assets/css/site.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/code/github.css" />

<!--[if IE]>
<script src="/assets/js/html5.js"></script>
<![endif]-->
</head>

<body class="page-type-post" data-name="">
<div class="main">
	<div class="trace">/ <a href="/">挪墨的空间</a> / html5 文件拖放的一个简单实例</div>

<article>
	<h1><a href="/posts/html5-drag-drop.html">html5 文件拖放的一个简单实例</a></h1>
	
	<p class="meta">
	<span class="datetime">2011-06-09</span> posted in [<a href="/category/html5" class="category">html5</a>]
</p>
	<div class="bct fc05 fc11 nbw-blog ztag js-fs2"><br>人人网最近推出了一个快捷上传相片功能：<br>

    <div><img alt="html5浏览器文件拖放的一个简单实例 - nomospace（挪墨） - Nomospace" style="margin:0 10px 0 0;"
              src="/assets/images/2309783658888408170.png"></div>
    <br>这种直接拖放相片至浏览器的作法让传统的表单或者flash上传黯然失色，用户体验比较好。根据<a target="_blank" rel="nofollow" href="http://twitter.com/sofish">sofish</a>的博文<a
            target="_blank" rel="nofollow" href="http://sofish.de/1545">提升用户体验：HTML5 拖放文件上传</a>以及<a target="_blank"
                                                                                                    rel="nofollow"
                                                                                                    href="http://www.jsmix.com/">小展</a>的<a
            target="_blank" rel="nofollow" href="http://www.jsmix.com/html5/html5-file-pre-test.html">HTML5中File对象初探</a>一文的指导，自己也写了一个demo。实现原理上述两位已经作了很好的总结，在此没有必要赘述。demo核心是html5
    FileReader以及拖放Drag and Drop，具体逻辑见<a target="_blank" rel="nofollow"
                                        href="https://github.com/nomospace/nomospace.github.com/tree/master/lab/2011/fileReader">我的源代码@github</a>。<br><br><a href="/lab/2011/fileReader/fileReader.html" target="_blank" rel="nofollow">demo</a>在fx4/chrome11中的效果图：<br>

    <div>
        <div>
            <div><img alt="html5文件拖放的一个简单实例 - nomospace（挪墨） - Nomospace" style="margin:0 10px 0 0;"
                      src="/assets/images/3671841071191473892.png"></div>
            &nbsp;<br>编码过程中遇到了一个问题：chrome11下的FileReader没有很好地实现EventTarget，于是当使用addEventListener时会抛出Object #&lt;FileReader&gt;
            has no method 'addEventListener'，见<a target="_blank" rel="nofollow"
                                                 href="http://code.google.com/p/chromium/issues/detail?id=48367">Issue
            48367</a>。fx4下却没有这个问题，目前的解决方案看似只能通过(new FileReader()).on事件名来实现了，最后附上<a target="_blank" rel="nofollow"
                                                                                   href="http://t.cn/aKZT2W">File
            API的Event Handler Attributes</a>。<br><br></div>
    </div>
    <font color="#c0c0c0"><i>注：本文示例代码仅完全适用于 Firefox 3.6+ ，部分适用于其他支持 HTML 5 接口的浏览器，完全不适用于 IE8 及以下版本 。</i></font><br><br>参考资料：<br><a
            target="_blank" rel="nofollow" href="http://sofish.de/1545">提升用户体验：HTML5 拖放文件上传</a><br><a target="_blank"
                                                                                                      rel="nofollow"
                                                                                                      href="http://dev.w3.org/2006/webapi/FileAPI/">W3C
        File API</a><br><a target="_blank" rel="nofollow" href="http://www.jsmix.com/html5/html5-file-pre-test.html">HTML5中File对象初探</a><br><a
            target="_blank" rel="nofollow" href="http://dev.w3.org/html5/spec/dnd.html">W3C Drag and drop</a><br><a
            class="link_external" rel="nofollow" href="https://developer.mozilla.org/en/DOM/File">MDC File</a><br><a
            target="_blank" rel="nofollow"
            href="http://blog.bingo929.com/google-enjoy-html5-drag-drop-filereaderenren.html">给力的 Google HTML5 训练营(HTML5
        Drag&amp;Drop 拖拽、FileReader实例教程)</a></div>


	
	<!--<p class="permalink">永久链接：<a href="http://nomospace.github.com/posts/html5-drag-drop.html">http://nomospace.github.com/posts/html5-drag-drop.html</a></p>-->
</article>
<div id="disqus_thread" class="comments"></div>

	<footer>
		<p>&copy; Since 2012 <a href="http://github.com/nomospace" target="_blank">github.com/nomospace</a></p>
	</footer>
</div>

<aside>
	<h2><a href="/">挪墨的空间</a><a href="/feed.xml" class="feed-link" title="RSS订阅"><img src="http://blog.rexsong.com/wp-content/themes/rexsong/icon_feed.gif" alt="RSS feed" /></a></h2>
	<div class="block block-about">
	  <h3>分类</h3>
		<ul>
		<li class="javascript"><a href="/category/javascript/">javascript</a></li>
		<li class="node"><a href="/category/node/">node</a></li>
		<li class="css"><a href="/category/css/">css</a></li>
		<li class="html5"><a href="/category/html5/">html5</a></li>
		<li class="frontend"><a href="/category/frontend/">frontend</a></li>
		
		</ul>
	</div>

	<form action="/search/" class="block block-search">
		<h3>搜索</h3>
    <input type="search" name="q" placeholder="输入关键词按回车搜索" />
	</form>

	<div class="block block-about">
		<h3><a href="/douban">我的豆瓣</a></h3>
	</div>

	<div class="block block-about">
		<h3><a href="/projects">我的项目</a></h3>
	</div>

	<div class="block block-about" style="display:none;">
    <h3>关于</h3>
		<figure>
			<img src="http://www.gravatar.com/avatar/d6e8639fcaea0c7c0fab106033f05de0?s=80" />
			<figcaption><strong>nomospace</strong></figcaption>
		</figure>
	</div>

	<a href="http://github.com/nomospace" class="forkme"><img src="/assets/images/forkmeongithub.png" alt="Fork me on GitHub"></a>

    <div class="block block-license">
        <h3>版权申明</h3>
        <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/cn/" target="_blank" class="hide-target-icon" title="Copyright declaration of site content"><img alt="知识共享许可协议" src="http://i.creativecommons.org/l/by-nc-nd/2.5/cn/88x31.png" /></a></p>
    </div>

	<div class="block block-thank">
        <h3>Powered by</h3>
        <p>
            <a href="http://disqus.com/" target="_blank">Disqus</a>,
            <a href="http://www.google.com/cse/" target="_blank">Google Custom Search</a>,
            <a href="https://github.com/" target="_blank">GitHub</a>,
            <a href="http://en.gravatar.com/" target="_blank">Gravatar</a>,
            <a href="http://softwaremaniacs.org/soft/highlight/en/">HighlightJS</a>,
            <a href="https://github.com/mojombo/jekyll" target="_blank">jekyll</a>,
            <a href="https://github.com/mytharcher/SimpleGray" target="_blank">SimpleGray</a>
        </p>
    </div>
</aside>

<script src="/assets/js/highlight.js"></script>
<script src="/assets/js/hljs/languages/css.js"></script>
<script src="/assets/js/hljs/languages/xml.js"></script>
<script src="/assets/js/hljs/languages/javascript.js"></script>
<script src="/assets/js/hljs/languages/ruby.js"></script>
<script src="/assets/js/jquery-1.8.0.min.js"></script>

    <script src="http://nomospace.disqus.com/embed.js"></script>

<script src="/assets/js/site.js"></script>
<script>
    var _errs=["4fcf6a84a57ce4043f00032a"];(function(a,b){a.onerror=function(){_errs.push(arguments)};
    var d=function(){var a=b.createElement("script"),c=b.getElementsByTagName("script")[0];
    a.src="//d15qhc0lu1ghnk.cloudfront.net/beacon.js";a.async=!0;
    c.parentNode.insertBefore(a,c)};a.addEventListener?a.addEventListener("load",d,!1):
    a.attachEvent("onload",d)})(window,document);
</script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31926992-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F98b0bb1f70082dc53d1cfaafd343ce0c' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>
